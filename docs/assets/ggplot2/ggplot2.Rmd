---
title: "GGplot2"
output: 
  xaringan::moon_reader:
    seal: false
    libs: libs
    css: ["css/xaringan.css", "default", "default-fonts"]
    nature:
      ratio: '16:9'
      highlightLines: true
      highlightSpans: false
      highlightStyle: github
      countIncrementalSlides: false
      countdown: false
      slideNumberFormat: '%current%'
      navigation:
        scroll: false
editor_options: 
  chunk_output_type: console
---

class: inverse, middle, center

## .LARGE[.orange[Making figures using the grammar of graphics]]

---

background-image: url("../figs/03_gglayers.png")
background-size: 40%
background-position: 100% 50%

## .Large[.center[The Grammar of Graphics (`gg`)]]

.large[Any graphic can be built from the same components:]

.large[1.] .large[.blue[`data`] to be drawn from]

.large[2.] .large[.blue[`aesthetic mappings`] from data to some visual marking]

.large[3.] .large[.blue[`geometric`] objects on the plot]

.large[4.] .large[.blue[`scales`] define the range of values]

.large[5.] .large[.blue[`coordinates`] to organize location]

.large[6.] .large[.blue[`labels`] describe the scale and markings]

.large[7.] .large[.blue[`facets`] group into subplots]

.large[8.] .large[.blue[`themes`] style the plot elements]
<br><br><br>
.blue[.Large[**Not every plot needs every component, but all plots must have the first 3!**]]

---

background-image: url("../figs/03_gglayers.png")
background-size: 40%
background-position: 100% 50%

## .Large[.center[The Grammar of Graphics (`gg`)]]

.large[Any graphic can be built from the same components:]

.large[1.] .large[.blue[`**data**`] to be drawn from]

.large[2.] .large[.blue[`**aes**thetic mappings`] from data to some visual marking]

.large[3.] .large[.blue[`**geom**etric`] objects on the plot]

.large[4.] .large[.blue[`**scales**`] define the range of values]

.large[5.] .large[.blue[`**coord**inates`] to organize location]

.large[6.] .large[.blue[`**labels**`] describe the scale and markings]

.large[7.] .large[.blue[`**facet**s`] group into subplots]

.large[8.] .large[.blue[`**theme**s`] style the plot elements]
<br><br><br>
.blue[.Large[**Not every plot needs every component, but all plots must have the first 3!**]]

---

## .Large[.center[Data]]

## Data used in this course
```{r, echo=FALSE}
data <- readRDS("../data/data.rds")
```

.pull-left[
```{r, echo=FALSE}
gt::gt(head(data$anno, 10))
```
]

.pull-right[
```{r, echo=FALSE}
gt::gt(head(data$counts, 4))
```

```{r, echo=FALSE}
gt::gt(head(data$diff, 4))
```
]

---

## Data for plotting: `longer` format

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
dat <- data$counts
dat <- reshape2::melt(data$counts, value.name = "expression", variable.name = "sample")
dat <- merge(data$anno, dat)
dat <- dat[,-6]
gt::gt(head(dat, 12))
```

---

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
library(flipbookr)
dat <- data$counts
dat <- reshape2::melt(data$counts, value.name = "expression")
dat <- merge(data$anno, dat)
```

```{r fig1, eval = FALSE, echo = FALSE}
ggplot(data = dat) + #BREAK
  aes(x = Sample_ID) + #BREAK
  aes(y = expression) + #BREAK
  aes(color = compound) + #BREAK
  aes(fill = compound) + #BREAK
  geom_boxplot() + #BREAK
  labs(x = "Samples") + #BREAK
  labs(y = "Expression") + #BREAK
  labs(title = "Boxplot") + #BREAK
  labs(subtitle = "Sucrose at 3h and 24h") + #BREAK
  labs(caption = "This is a Boxplot of Sucrose comparison.") #BREAK
```

`r chunk_reveal(chunk_name = "fig1", break_type = "user", title = "## .center[.Large[Step by step plotting: .blue[Boxplot]]]", widths = c(3,4), chunk_options = "fig.height = 7, fig.width = 8, fig.retina = 5")`

---

```{r fig2, eval = FALSE, echo = FALSE}
ggplot(data = dat) +
  aes(x = Sample_ID) +
  aes(y = expression) +
  aes(color = compound) +
  aes(fill = compound) +
  geom_boxplot() +
  labs(x = "Samples") +
  labs(y = "Expression") +
  labs(title = "Boxplot") +
  labs(subtitle = "Sucrose at 3h and 24h") +
  labs(caption = "This is a Boxplot of Sucrose comparison.") +
  facet_wrap(~dose) + #ROTATE
  facet_grid(dose~time) #ROTATE
```

`r chunk_reveal(chunk_name = "fig2", break_type = "rotate", title = "## .center[.Large[Step by step plotting: .blue[Boxplot]]]", widths = c(3,4), chunk_options = "fig.height = 7, fig.width = 8, fig.retina = 5")`

---

```{r fig3, eval = FALSE, echo = FALSE}
ggplot(data = dat) +
  aes(x = Sample_ID) +
  aes(y = expression) +
  aes(color = compound) +
  aes(fill = compound) +
  geom_boxplot() +
  labs(x = "Samples") +
  labs(y = "Expression") +
  labs(title = "Boxplot") +
  labs(subtitle = "Sucrose at 3h and 24h") +
  labs(caption = "This is a Boxplot of Sucrose comparison.") +
  facet_grid(dose~time) +
  theme_classic() + #ROTATE
  theme_dark() + #ROTATE
  theme_light() + #ROTATE
  theme_linedraw() + #ROTATE
  theme_minimal() + #ROTATE
  theme_void() + #ROTATE
  theme_bw() + #ROTATE
  theme_bw() #ROTATE
```

`r chunk_reveal(chunk_name = "fig3", break_type = "rotate", title = "## .center[.Large[Step by step plotting: .blue[Boxplot]]]", widths = c(3,4), chunk_options = "fig.height = 7, fig.width = 8, fig.retina = 5")`

---

```{r fig4, eval = FALSE, echo = FALSE}
ggplot(data = dat) +
  aes(x = Sample_ID) +
  aes(y = expression) +
  aes(color = compound) +
  aes(fill = compound) +
  geom_boxplot() +
  labs(x = "Samples") +
  labs(y = "Expression") +
  labs(title = "Boxplot") +
  labs(subtitle = "Sucrose at 3h and 24h") +
  labs(caption = "This is a Boxplot of Sucrose comparison.") +
  facet_grid(dose~time) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90)) + #BREAK
  theme(axis.text.x = element_text(vjust = 0.5)) #BREAK
```

`r chunk_reveal(chunk_name = "fig4", break_type = "user", title = "## .center[.Large[Step by step plotting: .blue[Boxplot]]]", widths = c(3,4), chunk_options = "fig.height = 7, fig.width = 8, fig.retina = 5")`


---

```{r fig5, eval = FALSE, echo = FALSE}
ggplot(data = dat) + #BREAK
  aes(
    x = Sample_ID, 
    y = expression,
    color = compound,
    fill = compound
    ) + #BREAK
  geom_boxplot() + #BREAK
  labs(
    x = "Samples", 
    y = "Expression",
    title = "Boxplot",
    subtitle = "Sucrose at 3h and 24h",
    caption = "This is a Boxplot of Sucrose comparison."
    ) + #BREAK
  facet_grid(dose~time) + #BREAK
  theme_bw() + #BREAK
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) #BREAK
```

`r chunk_reveal(chunk_name = "fig5", break_type = "user", title = "## .center[.Large[Step by step plotting: .blue[Boxplot]]]", widths = c(3,4), chunk_options = "fig.height = 7, fig.width = 8, fig.retina = 5")`

---

```{r fig6, eval = FALSE, echo = FALSE}
ggplot(data = dat) + #BREAK
  aes(
    x = Sample_ID, 
    y = expression,
    color = compound,
    fill = compound
    ) + #BREAK
  geom_col() + #BREAK
  labs(
    x = "Samples", 
    y = "Expression",
    title = "Barplot",
    subtitle = "Sucrose at 3h and 24h",
    caption = "This is a Barplot of Sucrose comparison."
    ) + #BREAK
  facet_grid(dose~time) + #BREAK
  theme_bw() + #BREAK
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) #BREAK
```

`r chunk_reveal(chunk_name = "fig6", break_type = "user", title = "## .center[.Large[Step by step plotting: .blue[Barplot]]]", widths = c(3,4), chunk_options = "fig.height = 7, fig.width = 8, fig.retina = 5")`

---

```{r fig7, eval = FALSE, echo = FALSE, warning=FALSE, message=FALSE}
ggplot(data = dat) + #BREAK
  aes(x = expression) + #BREAK
  geom_histogram() + #BREAK
  labs(
    x = "Expression", 
    y = "Counts",
    title = "Histogram",
    subtitle = "Sucrose at 3h and 24h",
    caption = "This is a Histogram of Sucrose comparison."
    ) + #BREAK
  facet_grid(dose~time) + #BREAK
  theme_bw() + #BREAK
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) #BREAK
```

`r chunk_reveal(chunk_name = "fig7", break_type = "user", title = "## .center[.Large[Step by step plotting: .blue[Histogram]]]", widths = c(3,4), chunk_options = "fig.height = 7, fig.width = 8, fig.retina = 5")`

---

```{r fig8, eval = FALSE, echo = FALSE}
ggplot(data = data$diff) + #BREAK
  aes(
    x = sucrose_24h_lfc, 
    y = sucrose_3h_lfc,
    color = sucrose_24h_pval,
    size = sucrose_3h_pval
    ) + #BREAK
  geom_point() + #BREAK
  labs(
    title = "Scatterplot",
    subtitle = "Sucrose at 3h and 24h",
    caption = "This is a Scatterplot of log-fold-change comparison."
    ) + #BREAK
  theme_bw() + #BREAK
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) + #BREAK
  geom_abline() + #BREAK
  scale_color_viridis_c()  + #BREAK
```

`r chunk_reveal(chunk_name = "fig8", break_type = "user", title = "## .center[.Large[Step by step plotting: .blue[Scatter plot]]]", widths = c(3,4), chunk_options = "fig.height = 7, fig.width = 8, fig.retina = 5")`